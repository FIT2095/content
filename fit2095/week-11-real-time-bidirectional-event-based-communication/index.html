<?xml version="1.0" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="square-box">&#xD;
&#xD;
Question: If a server wants to push (send) data to a client, the client has to send an HTTP first; is there a way to send messages from the server to clients in real-time?&#xD;
&#xD;
Answer: Yes. WebSocket protocol provides a full-duplex communication channel through a single TCP/IP connection.&#xD;
&#xD;
</div>&#xD;
<div class="square-box">&#xD;
&#xD;
Question: Is there a package that&#xC2;&#xA0;simplifies the usage of WebSockets?&#xD;
&#xD;
Answer: Yes. Socket.io&#xD;
&#xD;
</div>&#xD;
&#xA0;&#xD;
<h2>What is Socket.io?</h2>&#xD;
Socket.IO is a library that enables real-time, bidirectional and event-based communication between the browser and the server. It consists of:&#xD;
<ul><li>a Node.js server</li>&#xD;
 	<li>a Javascript client library for the browser</li>&#xD;
</ul>&#xD;
&#xA0;&#xD;
<h3>Socket.io main features [1]</h3>&#xD;
<ul><li>Reliability</li>&#xD;
 	<li>Auto-reconnection support:&#xD;
<ul><li>Unless instructed otherwise a disconnected client will try to reconnect forever until the server is available again.</li>&#xD;
</ul></li>&#xD;
 	<li>Disconnection detection&#xD;
<ul><li>A heartbeat mechanism is available, allowing both the server and the client to know when the other one is not responding anymore.</li>&#xD;
</ul></li>&#xD;
 	<li>Binary support:&#xD;
<ul><li>Any serializable data structures can be emitted.</li>&#xD;
</ul></li>&#xD;
 	<li>Multiplexing support:&#xD;
<ul><li>In order to create the separation of concerns within your application (for example per module, or based on permissions), Socket.IO allows you to create several&#xC2;&#xA0;<a href="https://socket.io/docs/rooms-and-namespaces/#Namespaces">Namespaces</a>, which will act as separate communication channels but will share the same underlying connection.</li>&#xD;
</ul></li>&#xD;
 	<li>Room support:&#xD;
<ul><li>Within each&#xC2;&#xA0;<a href="https://socket.io/docs/rooms-and-namespaces/#Namespaces">Namespace</a>, you can define arbitrary channels, called&#xC2;&#xA0;<a href="https://socket.io/docs/rooms-and-namespaces/#Rooms">Rooms</a>, that sockets can join and leave. You can then broadcast to any given room, reaching every socket that has joined it. This is a useful feature to send notifications to a group of users, or to a given user connected on several devices for example.</li>&#xD;
</ul></li>&#xD;
</ul>&#xD;
&#xA0;&#xD;
&#xD;
&#xA0;&#xD;
&#xD;
<a href="https://www.alexandriarepository.org/media/drawing11" rel="attachment wp-att-164006"><img class="size-full wp-image-164006 aligncenter" src="./assets/Drawing11.jpg" alt="" width="717" height="500"/></a>&#xD;
&#xD;
&#xA0;&#xD;
<h2>A Chat Application using Node.js, Express, Angular, and Socket.io</h2>&#xD;
&#xA0;&#xD;
<h3>Server Side (Node.js and Express)</h3>&#xD;
<ul><li>Create a file named server.js</li>&#xD;
 	<li>Install Socket.io server-side library</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">npm install  socket.io</pre>&#xD;
&#xA0;&#xD;
<ul><li>Install Express</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="shell">npm install  express</pre>&#xD;
&#xA0;&#xD;
<ul><li>Create an instance of Express application</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">var app = require('express')();&#xD;
var server = require('http').Server(app);</pre>&#xD;
<blockquote>Line 2: Socket.io is attached to an instance of http.Server and adds handlers to it.</blockquote>&#xD;
&#xA0;&#xD;
<ul><li>Create an&#xC2;&#xA0;instance of Socket.io server</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="js">let io = require("socket.io")(server);</pre>&#xD;
&#xA0;&#xD;
<ul><li>Wait for connections:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="js">io.on("connection", function(socket) {&#xD;
  console.log("new connection made");&#xD;
}</pre>&#xD;
&#xA0;&#xD;
<ul><li>Now, wait for events (messages):</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="js">  socket.on("eventName", function(data){&#xD;
    console.log("got data ");&#xD;
}</pre>&#xD;
&#xA0;&#xD;
<ul><li>If you have more than one event:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">  socket.on("event1", function(data){&#xD;
    console.log("got data from event 1 ");&#xD;
}&#xD;
  socket.on("event2", function(data){&#xD;
    console.log("got data from event 2 ");&#xD;
}</pre>&#xD;
&#xA0;&#xD;
<ul><li>To send a message to all connected sockets (i.e. clients)</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="js">io.sockets.emit("anotherEventName", data);&#xD;
</pre>&#xD;
&#xA0;&#xD;
<ul><li>or to send to a single client:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">socket.emit("justAnotherEvent", data);&#xD;
</pre>&#xD;
&#xA0;&#xD;
&#xD;
So, the server side in one piece&#xD;
<pre class="EnlighterJSRAW" data-enlighter-language="js">let express = require("express");&#xD;
let path = require("path");&#xD;
let app = express();&#xD;
let server = require("http").Server(app);&#xD;
&#xD;
let io = require("socket.io")(server);&#xD;
&#xD;
let port = 8080;&#xD;
&#xD;
app.use("/", express.static(path.join(__dirname, "dist/chatApp")));&#xD;
&#xD;
io.on("connection", socket =&gt; {&#xD;
  console.log("new connection made from client with ID="+socket.id);&#xD;
&#xD;
  socket.on("newMsg", data =&gt; {&#xD;
    io.sockets.emit("msg", { msg: data, timeStamp: getCurrentDate() });&#xD;
  });&#xD;
});&#xD;
&#xD;
server.listen(port, () =&gt; {&#xD;
  console.log("Listening on port " + port);&#xD;
});&#xD;
&#xD;
function getCurrentDate() {&#xD;
  let d = new Date();&#xD;
  return d.toLocaleString();&#xD;
}&#xD;
</pre>&#xD;
&#xA0;&#xD;
<h3/>&#xD;
<h3>Client-Side</h3>&#xD;
<ul><li>Create a new Angular Application using:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">ng new chatapp</pre>&#xD;
<ul><li>Add the server-side source code 'server.js' to the root folder of the Angular app</li>&#xD;
 	<li>Install socket.io client-side libraries</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="shell">npm install socket.io-client&#xD;
npm install @types/socket.io-client</pre>&#xD;
&#xA0;&#xD;
<ul><li>open app.component.ts and import&#xC2;&#xA0;socket.io-client</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="js">import { io } from 'socket.io-client';</pre>&#xD;
&#xA0;&#xD;
<ul><li>Create an instance of the socket.io client</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="js">let socket: any;</pre>&#xD;
&#xA0;&#xD;
<ul><li>Send a connection request to the server:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="js">this.socket = io();</pre>&#xD;
&#xA0;&#xD;
<ul><li>The client&#xC2;&#xA0;has to listen to messages from its server:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">this.socket.on("eventName", theMsg =&gt; {});</pre>&#xD;
&#xA0;&#xD;
<ul><li>If the client wants to send a message to the server:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">this.socket.emit("justAnotherEventName", this.messageText);</pre>&#xD;
&#xA0;&#xD;
<ul><li>So, the client-side app.component.ts in one piece:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="js">import { Component } from "@angular/core";&#xD;
import { io } from 'socket.io-client';&#xD;
@Component({&#xD;
  selector: "app-root",&#xD;
  templateUrl: "./app.component.html",&#xD;
  styleUrls: ["./app.component.css"],&#xD;
})&#xD;
export class AppComponent {&#xD;
  messageText: string;&#xD;
  messages: Array&lt;any&gt; = [];&#xD;
  socket:any;&#xD;
  constructor() {&#xD;
    this.socket = io();&#xD;
  }&#xD;
  ngOnInit() {&#xD;
    this.messages = new Array();&#xD;
    this.listen2Events();&#xD;
  }&#xD;
  listen2Events() {&#xD;
    this.socket.on("msg", data =&gt; {&#xD;
      this.messages.push(data);&#xD;
    });&#xD;
  }&#xD;
&#xD;
  sendMessage() {&#xD;
    this.socket.emit("newMsg", this.messageText);&#xD;
    this.messageText = "";&#xD;
  }&#xD;
}</pre>&#xD;
&#xA0;&#xD;
<ul><li>and app.component.html:</li>&#xD;
</ul><pre class="EnlighterJSRAW" data-enlighter-language="html">&lt;div id="chatContainer"&gt;&#xD;
  &lt;div class="chatform"&gt;&#xD;
    &lt;div class="form-group"&gt;&#xD;
      &lt;label for="userName"&gt;Your Name&lt;/label&gt;&#xD;
      &lt;input type="text" class="form-control" id="userName" placeholder="Your name" [(ngModel)]="userName"&gt;&#xD;
    &lt;/div&gt;&#xD;
    &lt;div class="form-group"&gt;&#xD;
      &lt;label for="message"&gt;Message&lt;/label&gt;&#xD;
      &lt;input type="text" class="form-control" id="message" placeholder="Your message" [(ngModel)]="messageText"&gt;&#xD;
    &lt;/div&gt;&#xD;
&#xD;
    &lt;button (click)="sendMessage()" type="submit" class="btn btn-primary"&gt;Send &lt;/button&gt;&#xD;
  &lt;/div&gt;&#xD;
&#xD;
&#xD;
  &lt;div class="container" *ngFor="let item of messages.slice().reverse() "&gt;&#xD;
    &lt;p&gt;From: {{item.userName}}&lt;/p&gt;&#xD;
    &lt;div&gt;&#xD;
      &lt;h3&gt;{{item.msg}}&lt;/h3&gt;&#xD;
    &lt;/div&gt;&#xD;
    &lt;span class="time-right"&gt;{{item.timeStamp}}&lt;/span&gt;&#xD;
  &lt;/div&gt;&#xD;
&lt;/div&gt;&#xD;
</pre>&#xD;
&#xA0;&#xD;
<ul><li>and app.component.css</li>&#xD;
</ul><pre class="EnlighterJSRAW" data-enlighter-language="css">html,&#xD;
body {&#xD;
  height: 100%;&#xD;
}&#xD;
&#xD;
#chatContainer {&#xD;
  height: 80vh !important;&#xD;
  overflow-y: auto;&#xD;
  padding-left: 2vw;&#xD;
  padding-top: 2vh;&#xD;
}&#xD;
.chatform input{&#xD;
    margin-bottom: 2vh;&#xD;
    margin-left: 1vh;&#xD;
    width: 90%;&#xD;
&#xD;
}&#xD;
.chatform{&#xD;
  background-color:beige;&#xD;
  width: 50%;&#xD;
&#xD;
}&#xD;
&#xD;
.container {&#xD;
  border: 2px solid #dedede;&#xD;
  background-color: #f1f1f1;&#xD;
  border-radius: 5px;&#xD;
  padding: 10px;&#xD;
  margin: 10px 0;&#xD;
}&#xD;
&#xD;
.container::after {&#xD;
  content: "";&#xD;
  clear: both;&#xD;
  display: table;&#xD;
}&#xD;
&#xD;
.time-right {&#xD;
  float: right;&#xD;
  color: #aaa;&#xD;
}&#xD;
</pre>&#xD;
&#xA0;&#xD;
&#xD;
&#xA0;&#xD;
&#xD;
The final project structure:&#xD;
&#xD;
<a href="https://www.alexandriarepository.org/media/chatapppro" rel="attachment wp-att-164032"><img class="alignnone size-full wp-image-164032" src="./assets/chatApppro.png" alt="" width="316" height="834"/></a>&#xD;
&#xD;
&#xA0;&#xD;
<ul><li>build your client-side:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">ng build</pre>&#xD;
<ul><li>and run your server:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">node server.js</pre>&#xD;
&#xA0;&#xD;
&#xD;
And here is the expected output:&#xD;
&#xD;
&#xA0;&#xD;
&#xD;
<a href="https://www.alexandriarepository.org/media/week11-socket-chat2" rel="attachment wp-att-181438"><img class="size-full wp-image-181438 aligncenter" src="./assets/week11-socket-chat2.gif" alt="" width="480" height="417"/></a>&#xD;
<h3/>&#xD;
<h3/>&#xD;
<h3/>&#xD;
<h3>Socket.io Emit Cheatsheet</h3>&#xD;
<pre class="EnlighterJSRAW" data-enlighter-language="js">io.on('connect', onConnect);&#xD;
&#xD;
function onConnect(socket){&#xD;
&#xD;
  // sending to the client&#xD;
  socket.emit('hello', 'can you hear me?', 1, 2, 'abc');&#xD;
&#xD;
  // sending to all clients except sender&#xD;
  socket.broadcast.emit('broadcast', 'hello friends!');&#xD;
&#xD;
  // sending to all clients in 'game' room except sender&#xD;
  socket.to('game').emit('nice game', "let's play a game");&#xD;
&#xD;
  // sending to all clients in 'game1' and/or in 'game2' room, except sender&#xD;
  socket.to('game1').to('game2').emit('nice game', "let's play a game (too)");&#xD;
&#xD;
  // sending to all clients in 'game' room, including sender&#xD;
  io.in('game').emit('big-announcement', 'the game will start soon');&#xD;
&#xD;
  // sending to all clients in namespace 'myNamespace', including sender&#xD;
  io.of('myNamespace').emit('bigger-announcement', 'the tournament will start soon');&#xD;
&#xD;
  // sending to a specific room in a specific namespace, including sender&#xD;
  io.of('myNamespace').to('room').emit('event', 'message');&#xD;
&#xD;
  // sending to individual socketid (private message)&#xD;
  io.to(`${socketId}`).emit('hey', 'I just met you');&#xD;
&#xD;
  // WARNING: `socket.to(socket.id).emit()` will NOT work, as it will send to everyone in the room&#xD;
  // named `socket.id` but the sender. Please use the classic `socket.emit()` instead.&#xD;
&#xD;
  // sending with acknowledgement&#xD;
  socket.emit('question', 'do you think so?', function (answer) {});&#xD;
&#xD;
  // sending without compression&#xD;
  socket.compress(false).emit('uncompressed', "that's rough");&#xD;
&#xD;
  // sending a message that might be dropped if the client is not ready to receive messages&#xD;
  socket.volatile.emit('maybe', 'do you really need it?');&#xD;
&#xD;
  // specifying whether the data to send has binary data&#xD;
  socket.binary(false).emit('what', 'I have no binaries!');&#xD;
&#xD;
  // sending to all clients on this node (when using multiple nodes)&#xD;
  io.local.emit('hi', 'my lovely babies');&#xD;
&#xD;
  // sending to all connected clients&#xD;
  io.emit('an event sent to all connected clients');&#xD;
&#xD;
};</pre>&#xD;
Source:&#xC2;&#xA0;<a href="https://socket.io/docs/emit-cheatsheet/">https://socket.io/docs/emit-cheatsheet/</a>&#xD;
&#xD;
<hr/><hr/><h2>Text to Speech Google Cloud Service</h2>&#xD;
<div class="l-showcase-content l-pad-right-40">&#xD;
<p class="text-body">Google Cloud Text-to-Speech enables developers to synthesize natural-sounding speech with 30 voices, available in multiple languages and variants. It applies DeepMind&#xE2;&#x80;&#x99;s groundbreaking research in WaveNet and Google&#xE2;&#x80;&#x99;s powerful neural networks to deliver high fidelity audio. With this easy-to-use API, you can create lifelike interactions with your users, across many applications and devices.</p>&#xD;
Advantages of using Cloud Services:&#xD;
<ul><li>Easy to integrate</li>&#xD;
 	<li>Heavily tested</li>&#xD;
 	<li>Pay as you go</li>&#xD;
 	<li>No need to reinvent the wheel</li>&#xD;
 	<li>Developing a reliable and accurate text to speech service (for instance) might take months.</li>&#xD;
</ul></div>&#xD;
&#xA0;&#xD;
<div class="square-box">&#xD;
&#xD;
Develop an application that converts a text to a speech using Google Cloud Services.&#xD;
&#xD;
</div>&#xD;
This application has only the server-side that uses Google cloud service to convert a text to an MP3 file.&#xD;
<h3>Configurations</h3>&#xD;
<ul><li>Set up authentication:&#xD;
<ul><li>Go to the&#xC2;&#xA0;<b>Create service account key</b>&#xC2;&#xA0;page in the GCP Console.&#xD;
<ul><li><a href="https://console.cloud.google.com/apis/credentials/serviceaccountkey">https://console.cloud.google.com/apis/credentials/serviceaccountkey</a></li>&#xD;
</ul></li>&#xD;
 	<li>From the&#xC2;&#xA0;<b>Service account</b>&#xC2;&#xA0;drop-down list, select&#xC2;&#xA0;<b>New service account</b>.</li>&#xD;
 	<li>Enter a name into the&#xC2;&#xA0;<b>Service account name</b>&#xC2;&#xA0;field.</li>&#xD;
 	<li>Don't select a value from the&#xC2;&#xA0;<b>Role</b>&#xC2;&#xA0;drop-down list. No role is required to access this service.</li>&#xD;
 	<li>Click&#xC2;&#xA0;<b>Create</b>. A note appears, warning that this service account has no role.</li>&#xD;
 	<li>Click&#xC2;&#xA0;<b>Create without role</b>. A JSON file that contains your key downloads to your computer (name it fit2095.json).</li>&#xD;
</ul></li>&#xD;
 	<li>Set the environment variable&#xC2;&#xA0;<var>GOOGLE_APPLICATION_CREDENTIALS</var>&#xC2;&#xA0;to the file path of the JSON file that contains your service account key. This variable only applies to your current shell session, so if you open a new session, set the variable again.&#xD;
<ul><li>Examples&#xD;
<ul><li>Linux or macOS:&#xC2;&#xA0;<code class="EnlighterJSRAW" data-enlighter-language="null">export GOOGLE_APPLICATION_CREDENTIALS="/home/user/Downloads/service-account-file.json"</code></li>&#xD;
 	<li>Windows:&#xC2;&#xA0;<code class="EnlighterJSRAW" data-enlighter-language="shell">$env:GOOGLE_APPLICATION_CREDENTIALS="C:\Users\username\Downloads\[FILE_NAME].json"</code></li>&#xD;
</ul></li>&#xD;
</ul></li>&#xD;
 	<li>Enable the&#xC2;&#xA0;Cloud Text-to-Speech API.&#xD;
<ul><li>From the menu, select APIs &amp; Services--&gt;Library</li>&#xD;
 	<li>Search for text to speech service</li>&#xD;
 	<li>Click on Enable (or ignore if the service is already enabled)</li>&#xD;
</ul></li>&#xD;
 	<li>Install and initialize the Cloud SDK.&#xD;
<ul><li>Download and install Google SDK by following all the steps on this page:&#xD;
<ul><li><a href="https://cloud.google.com/sdk/docs/">https://cloud.google.com/sdk/docs/</a></li>&#xD;
</ul></li>&#xD;
</ul></li>&#xD;
</ul><h3>Server Side</h3>&#xD;
<ul><li>Create a new folder named text2speech</li>&#xD;
 	<li>Install&#xC2;&#xA0;Google Cloud client library</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="shell">npm install --save @google-cloud/text-to-speech</pre>&#xD;
<ul><li>Create a file named server.js and paste this code in it:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="null">const fs = require("fs");&#xD;
&#xD;
// Imports the Google Cloud client library&#xD;
const textToSpeech = require("@google-cloud/text-to-speech");&#xD;
&#xD;
// Creates a client&#xD;
const client = new textToSpeech.TextToSpeechClient();&#xD;
&#xD;
// The text to synthesize&#xD;
const text = "Hello from FIT2095 Week 11 lecture";&#xD;
&#xD;
// Construct the request&#xD;
const request = {&#xD;
  input: { text: text },&#xD;
  // Select the language and SSML Voice Gender (optional)&#xD;
  voice: { languageCode: "en-US", ssmlGender: "NEUTRAL" },&#xD;
  // Select the type of audio encoding&#xD;
  audioConfig: { audioEncoding: "MP3" },&#xD;
};&#xD;
&#xD;
// Performs the Text-to-Speech request&#xD;
client.synthesizeSpeech(request, (err, response) =&gt; {&#xD;
  if (err) {&#xD;
    console.error("ERROR:", err);&#xD;
    return;&#xD;
  }&#xD;
&#xD;
  // Write the binary audio content to a local file&#xD;
  fs.writeFile("output.mp3", response.audioContent, "binary", err =&gt; {&#xD;
    if (err) {&#xD;
      console.error("ERROR:", err);&#xD;
      return;&#xD;
    }&#xD;
    console.log("Audio content written to file: output.mp3");&#xD;
  });&#xD;
});&#xD;
</pre>&#xD;
<blockquote>Dont forget to set the environment variable&#xC2;&#xA0;GOOGLE_APPLICATION_CREDENTIALS as discussed earlier.</blockquote>&#xD;
&#xA0;&#xD;
<ul><li>The project structure will be:</li>&#xD;
</ul><a href="https://www.alexandriarepository.org/media/t2s-proj2" rel="attachment wp-att-164022"><img class="alignnone size-full wp-image-164022" src="./assets/t2s-proj2.png" alt="" width="266" height="258"/></a>&#xD;
&#xD;
&#xA0;&#xD;
<ul><li>run your app by:</li>&#xD;
</ul><pre class="EnlighterJSRAW" style="padding-left: 30px;" data-enlighter-language="shell">node server.js</pre>&#xD;
&#xA0;&#xD;
&#xD;
You will get a new file named output.mp3 added to your project. Open it and test the results.</body></html>
